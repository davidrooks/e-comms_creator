<!DOCTYPE html>
<html>
<head>
  <title>Ecomm creator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap -->
  <script src="/vendor/jquery-2.1.3.min.js"></script>
  <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <style>
      .makeMeDraggable {
          border: 1px solid black;
          margin: 0px;
          padding: 0px
      }
  </style>

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script>
  <script type="text/javascript">

      $(document).ready(function () {
          $("#save_ecomm").click(function () {
              console.log('create button clicked');
              $("img").each(function (index) {
                  console.log(index + ": " + $(this).attr("id"));
                  var position = $(this).position();
                  var id = $(this).attr("id");
                  console.log(index + "- left: " + position.left + ", top: " + position.top)
                  $.post("/ecomm/item/savePos", {id: id, x: position.left, y: position.top});
              })
          });
      });

      $(init);

      function init() {
          $('.makeMeDraggable').draggable({
              cursor: 'move',
              containment: 'content',
              stop: handleDragStop,
              snap: true
          });
      }

      function handleDragStop(event, ui) {
          var offsetTopXPos = parseInt(ui.offset.left);
          var offsetTopYPos = parseInt(ui.offset.top);
          var offsetBottomXPos = parseInt(ui.offset.right);
          var offsetBottomYPos = parseInt(ui.offset.bottom);
          var id = $(this).attr("id");

//          $.post("/ecomm/item/savePos", {id:id, x:offsetTopXPos, y:offsetTopYPos });
//          console.log("Drag stopped!\nOffset: (" + offsetTopXPos + ", " + offsetTopYPos + ")\n" + "ID = " + id + "\n\n");
      }

      //      $(document).ready(function() {
      //          $('.small img').each(function() {
      //              var maxWidth = 100; // Max width for the image
      //              var maxHeight = 100;    // Max height for the image
      //              var ratio = 0.5;  // Used for aspect ratio
      //              var width = $(this).width();    // Current image width
      //              var height = $(this).height();  // Current image height
      //
      //// Check if the current width is larger than the max
      //              if(width > maxWidth){
      //                  ratio = maxWidth / width;   // get ratio for scaling image
      //                  $(this).css("width", maxWidth); // Set new width
      //                  $(this).css("height", height * ratio);  // Scale height based on ratio
      //                  height = height * ratio;    // Reset height to match scaled image
      //                  width = width * ratio;    // Reset width to match scaled image
      //              }
      //
      //// Check if current height is larger than max
      //              if(height > maxHeight){
      //                  ratio = maxHeight / height; // get ratio for scaling image
      //                  $(this).css("height", maxHeight);   // Set new height
      //                  $(this).css("width", width * ratio);    // Scale width based on ratio
      //                  width = width * ratio;    // Reset width to match scaled image
      //              }
      //          });
      //      });

  </script>
</head>
<body>
<div class="container">
  <ul class="nav nav-pills">
    <li><a class="btn btn-default navbar navbar-brand glyphicon glyphicon-home" href="/">Home</a></li>
    <% if signed_in %>
        <li><a class="btn btn-default navbar navbar-brand glyphicon glyphicon-plus" href="/create">Create</a></li>
        <li><a class="btn btn-default navbar navbar-brand glyphicon glyphicon-plus" href="/index-new">Improved Index</a>
        </li>
    <% end %>
    <li role="presentation" class="dropdown active pull-right">
      <a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-expanded="true">
        <%= username %><span class="caret"></span>
      </a>
      <ul class="dropdown-menu" role="menu">
        <li><a href="/user/signin">Login</a></li>
        <li class="divider"></li>
        <li><a href="/user/logout">Logout</a></li>
      </ul>
    </li>

  </ul>


  <div>
    <% if @error then %>
        <div class="alert alert-error"><%= @error %></div>
    <% end %>
    <%= yield %>
  </div>

</div>


<!--&lt;!&ndash; jQuery (necessary for Bootstrap's JavaScript plugins) &ndash;&gt;-->
<!--<script src="/vendor/jquery-2.1.3.min.js"></script>-->
<!--&lt;!&ndash; Include all compiled plugins (below), or include individual files as needed &ndash;&gt;-->
<!--<script src="/vendor/bootstrap/js/bootstrap.min.js"></script>-->

</body>
</html>
